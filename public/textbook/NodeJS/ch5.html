<!--<title>Глава 5. Full-stack и стек MEAN</title>-->
<h1>Глава 5. Full-stack и стек MEAN</h1>
<h2>Введение в Full-stack</h2>
<p>При упоминании разработки full-stack подразумевается разработка всех частей
сайта или приложения. Full-stack начинается с БД и веб-сервера в прикладной
части, центральной частью становится логика приложения и управления, а окончанием — пользовательский интерфейс в клиентской части.</p>
<p>Стек <b>MEAN</b> включает четыре основные технологии:</p>
<ul>
    <li><b>MongoDB</b> — база данных;</li>
    <li><b>Express</b> — веб-фреймворк;</li>
    <li><b>AngularJS</b> — фреймворк клиентской части;</li>
    <li><b>Node.js</b> — веб-сервер</li>
</ul>

<h2>Краткая история веб-разработки</h2>
<p>В давние времена, когда Интернет был совсем юным, люди не ждали многого от
сайтов. Способ представления данных не был столь важен, гораздо больше всех
заботило то, что происходило за кулисами. Обычно, если вы немного знали Perl
и могли скомпоновать фрагмент HTML, то уже считались веб-разработчиком.</p>
<p>По мере распространения использования Интернета бизнес-компании начали
сильнее интересоваться тем, как они в нем представлены. В сочетании с улучшенной поддержкой браузерами каскадных таблиц стилей (Cascading Style Sheets(<i>CSS</i>)) и <i>JavaScript</i> такой интерес привел к тому, что реализация клиентской части стала более сложной. Речь больше не шла о способности компоновать HTML — приходилось тратить время на CSS и JavaScript, убеждаясь в привлекательности внешнего вида сайтов и их правильном функционировании. И все это должно было работать в различных браузерах, значительно хуже совместимых, чем сейчас.</p>
<p>Именно тогда стали различать разработчиков клиентской и прикладной частей.
Рост этого различия с течением времени демонстрирует рис. ниже:</p>
<img src="https://ltdfoto.ru/images/2024/07/07/image58cf696230ded090.png" alt="image58cf696230ded090.png" border="0" />
<p>В 2000-е годы библиотеки и фреймворки стали популярными и широко применяются в большинстве распространенных языков программирования как на стороне клиента, так и на стороне сервера. Вспомните <i>Dojo</i> и <i>jQuery</i> для клиентского JavaScript, а также <i>CodeIgniter</i> для PHP и <i>Ruby on Rails</i>. Эти фреймворки были спроектированы для облегчения жизни разработчика, снижения входного порога. Хорошая библиотека или фреймворк уменьшают сложность разработки, ускоряя написание кода и снижая требования к наличию специальных знаний. Эта тенденция к упрощению привела к возрождению разработчиков full-stack, создававших как клиентскую часть, так и стоящую за ней логику приложения:</p>
<img src="https://ltdfoto.ru/images/2024/07/07/image3f0422b74c1062f8.png" alt="image3f0422b74c1062f8.png" border="0" />
<p>Этот рисунок иллюстрирует скорее тенденцию, чем утверждение: «Все веб-разработчики должны быть разработчиками full-stack». Конечно, на протяжении всей истории Интернета существовали разработчики full-stack, а в перспективе, вероятнее всего, некоторые разработчики будут выбирать в качестве специализации клиентскую или серверную разработку. Я же стремлюсь показать, что благодаря использованию фреймворков и современных инструментов вам, чтобы быть хорошим веб-разработчиком, больше не надо выбирать одну из сторон.</p>
<p>Продолжая тенденцию фреймворков, в последние несколько лет отмечаем развивающуюся тенденцию к вынесению логики приложения из серверной части в клиентскую. Можно рассматривать это как программирование прикладной части
в клиентской. Наиболее популярные среди применяющих этот подход фреймворков JavaScript — <i>AngularJS</i>, <i>Backbone</i> и <i>Ember</i>.</p>

<h2>Преимущества разработки full-stack</h2>
<p>Преимуществами работы в команде являются следующие:</p>
<ul>
    <li>благодаря тому что вы понимаете, как устроены различные области и как они совместно функционируют, вы лучше видите более обширную картину;</li>
    <li>вы лучше понимаете, как действуют другие части команды и что им нужно для успешной работы;</li>
    <li>члены команды могут свободнее менять участок работы.</li>
</ul>
<p>Преимуществами самостоятельной работы следующие:</p>
<ul>
    <li>вы можете самостоятельно создавать приложения от начала до конца, не завися от других людей;</li>
    <li>вы приобретаете больше навыков и имеете возможность предложить своим заказчикам большее число услуг.</li>
</ul>

<h2>Почему именно стек MEAN</h2>
<p>Стек <b>MEAN</b> объединяет несколько лучших в своем классе современных веб-технологий в очень мощный и гибкий стек. Одна из лучших его черт: он не просто использует JavaScript в браузере — он использует JavaScript повсюду. С помощью стека MEAN вы можете программировать как клиентскую, так и серверную часть на одном и том же языке.</p>
<p>Основная технология, которая делает это возможным, — Node.js, внедряющая
JavaScript в прикладную часть.</p>

<h3>Знакомимся с Node.js: веб-сервер/веб-платформа</h3>
<p>В двух словах: <b>Node.js</b> — программная платформа, позволяющая вам создать собственный веб-сервер и строить на нем веб-приложения. Node.js сам по себе не веб-сервер и не язык программирования. Он включает встроенную серверную библиотеку HTTP, следовательно, вам не нужно запускать отдельный веб-сервер, такой как <i>Apache</i> или <i>Internet Information Services</i> (<i>IIS</i>). В конечном счете вы получаете более полный контроль над работой своего веб-сервера за счет усложнения его установки и запуска, особенно в промышленной среде.</p>
<p>В случае PHP, например, вы можете легко найти виртуальный веб-хостинг, на
котором запущен Apache, отправить туда файлы по FTP, и — вуаля! — ваш сайт
работает. Это возможно, поскольку веб-хостинг заранее настроил Apache для вас
и других пользователей. </p>
<p>В случае Node.js все иначе, так как вы настраиваете сервер Node.js при создании приложения. Многие традиционные провайдеры вебхостинга отстают в смысле поддержки Node.js, но несколько новых хостингов, работающих по принципу «платформа как услуга» (<b>Platform as a Service</b> (<b>PaaS</b>)),
например <i>Heroku</i>, <i>Nodejitsu</i> и <i>OpenShift</i>, учитывают эту потребность. Подход к развертыванию промышленных сайтов на подобных PaaS-хостингах отличается от старой модели FTP, но если в нем разобраться, оказывается, что он довольно удобен.</p>
<p>Альтернативный подход к хостингу приложения Node.js состоит в выполнении
всей работы самостоятельно на выделенном сервере, на который можно установить
все необходимое. Но описание администрирования промышленного сервера потребовало бы отдельного учебника! Можно заменить любой из прочих компонентов
альтернативной технологией, и это ни на что не повлияет, но отказ от Node.js приведет к изменению всего, что надстроено поверх него.</p>

<h2>JavaScript: единый язык программирования для всего стека</h2>
<p>Одна из главных причин популярности платформы Node.js такова: для нее программируют на знакомом большинству программистов языке — JavaScript.</p>
<p>До сегодняшнего дня, если вы хотели быть разработчиком full-stack, вам нужно
было в совершенстве знать по крайней мере два языка программирования: JavaScript для клиентской части и что-то еще, например PHP или Ruby, — для серверной.</p>
<p>В конце 1990-х Microsoft выпустила технологию активных серверных страниц (Active Server Pages, ныне известную как классические ASP). ASP можно было писать как на VBScript, так и на JavaScript, но версия JavaScript не стала особенно популярной.</p>
<p>В основном это произошло потому, что на тот момент многим был привычен Visual Basic, на который похож VBScript. Большинство книг и веб-ресурсов были посвящены VBScript, так что он быстро стал стандартным языком классических ASP.</p>
<p>С выходом Node.js вы получили возможность использовать уже имеющиеся знания при программировании на серверной стороне. Изучение языка программирования — один из самых сложных этапов изучения новой технологии, но если вы
уже немного знакомы с JavaScript, то оказываетесь на шаг впереди других!</p>
<p>Конечно, для освоения Node.js характерна определенная кривая обучения, даже если вы уже опытный JavaScript-разработчик клиентской части. Проблемы и затруднения при серверном программировании отличаются от таковых при программировании клиентской части, но вы столкнулись бы с ними вне зависимости от используемой технологии. При разработке клиентской части вам будет важно убедиться, что все работает в множестве различных браузеров на различных устройствах.</p>
<p>В ходе работы над серверной частью вас станут больше заботить поток выполнения кода, отсутствие задержек и экономный расход системных ресурсов.</p>

<h2>Быстрая, производительная и масштабируемая платформа</h2>
<p>Еще одна причина популярности платформы Node.js заключается в том, что при
правильном программировании она работает очень быстро и чрезвычайно эффективно расходует системные ресурсы, что позволяет приложениям Node.js обслуживать больше пользователей при меньших системных ресурсах, чем большинству
других широко распространенных серверных технологий. Так что владельцам
компаний тоже нравится идея использования Node.js, ведь она может снизить текущие расходы даже при широкомасштабном применении.</p>
<p>За счет чего это происходит? Node.js использует мало системных ресурсов в силу своей однопоточности, тогда как традиционные веб-серверы многопоточны.
Посмотрим, что это значит, начав с традиционного многопоточного подхода.</p>
<h3>Традиционный многопоточный веб-сервер</h3>
<p>Большинство современных широко распространенных веб-серверов, включая
<i>Apache</i> и <i>IIS</i>, многопоточны. Это значит, что каждый новый посетитель (или сеанс) получает новый поток и связанный с этим потоком объем оперативной памяти, зачастую примерно 8 Мбайт.</p>
<div style="display: flex">
<img src="https://ltdfoto.ru/images/2024/07/07/imagec34bf8e511b2e095.png" alt="imagec34bf8e511b2e095.png" style="margin: 0px;height: 500px;align-items: center;" />
    <div style="
    display: flex;
    flex-direction: column;
    justify-content: center;">
        <p>Если говорить об аналогии из реального мира, представим себе двух человек, собирающихся в банк с различными целями. В многопоточной модели каждый из них пошел бы к отдельному банковскому клерку, который бы работал с их запросами.</p>
<p>Посетители и их выделенные ресурсы не знают друг о друге и не контактируют с другими посетителями и их ресурсами.</p>
<p>На рис. видно, что Саймон идет к банковскому клерку 1, а Салли — к банковскому клерку 2. Никто из них не знает друг о друге и никак на другого не влияет. Банковский клерк 1 на протяжении всей трансакции работает с Саймоном
и больше ни с кем, то же самое происходит у банковского клерка 2 и Салли.</p>
        <p>Такой подход работает идеально до тех пор, пока у вас имеется достаточно банковских клерков для обслуживания клиентов. Когда банк загружен работой и клиентов становится больше, чем сотрудников, обслуживание начинает замедляться
            и клиентам приходится ждать вызова.</p>
    </div>
</div>

<p>Банки обычно не слишком сильно волнуются насчет этого и, похоже, рады видеть очереди, но для сайтов это не так. Если сайт
возвращает вам ответ слишком медленно, вы, скорее всего, уйдете с него и никогда
не вернетесь.</p>
<p>Именно поэтому зачастую создаются веб-серверы с большим запасом мощности и оперативной памяти, которые 90 % времени не используются полностью.
Аппаратное обеспечение устанавливается с расчетом на громадный пик трафика.
Это все равно как если бы банк переехал в большее здание и нанял на полный
рабочий день 50 дополнительных клерков, поскольку в середине дня у них много
работы.</p>

<h3>Однопоточный веб-сервер</h3>
<p>Сервер Node.js — однопоточный и работает не так, как многопоточный. Вместо того чтобы предоставлять каждому посетителю отдельный поток и отдельный набор ресурсов, он всех посетителей соединяет с одним и тем же потоком. Посетитель и поток взаимодействуют только при необходимости — когда посетитель что-либо запрашивает или поток отвечает на запрос.</p>

<div style="display: flex">
<img src="https://ltdfoto.ru/images/2024/07/07/image692664030813f682.png" alt="image692664030813f682.png" style="margin: 0px;height: 500px;align-items: center;"/>
    <div style="
    display: flex;
    flex-direction: column;
    justify-content: center;">
        <p>Возвращаясь к аналогии с банковскими служащими, в данном случае будет только один клерк, работающий со всеми посетителями. Но вместо того, чтобы отходить и выполнять все запросы от начала до конца, он поручает все требующие много времени задачи персоналу резервного офиса и занимается следующим запросом.</p>
        <p>При однопоточном подходе, показанном, Салли и Саймон подают свои запросы одному и тому же сотруднику банка. Но вместо того, чтобы целиком работать с одним из них, клерк принимает первый запрос и передает его лицу, которое лучше всего может его обработать, прежде чем принять следующий запрос и поступить аналогичным образом. Когда клерку говорят, что задание выполнено, он передает результат непосредственно запросившему его посетителю.</p>
        <p>Несмотря на то что банковский клерк всего один, никто из посетителей не догадывается о наличии других и ни на кого из них не влияют запросы другого.</p>
        <p>Такой подход означает, что банку не требуется большое количество постоянно работающих клерков. Конечно, эта модель масштабируется не безгранично, но она более эффективна, чем многопоточная. Вы можете сделать больше, расходуя меньше ресурсов. Но это не означает, что вам никогда не понадобится добавлять ресурсы.</p>
    </div>
</div>

<p>Данный подход оказалось возможно реализовать в Node.js благодаря асинхронным возможностям JavaScript.</p>

<p>При однопоточной модели важно помнить, что все ваши пользователи используют один и тот же основной процесс. Чтобы сохранить плавное течение потока выполнения, необходимо убедиться в отсутствии в коде потенциальных блокирований одной операции другой, что может стать причиной задержки. </p>
<p>Примером такого блокирования может послужить хождение банковского клерка к сейфу, чтобы положить туда деньги Саймона, во время которого Салли пришлось бы ждать его возвращения, чтобы подать свой запрос.</p>
<p>Аналогично, если ваш основной процесс отвечает за чтение всех отдельных статических файлов, таких как CSS, JavaScript и изображения, он не сможет обрабатывать никакие другие запросы, блокируя, таким образом, поток выполнения. </p>
<p>Другая распространенная потенциально блокирующая задача — это взаимодействие с БД. Если процесс обращается к БД каждый раз, когда от него этого требуют, выполняет ли он поиск или сохранение данных, он не сможет делать ничего другого.</p>
<p>Поэтому, чтобы однопоточный подход работал, вы должны убедиться в том, что ваш код — неблокирующий. Добиться этого можно, сделав выполнение всех блокирующих операций асинхронным, что предотвратит блокирование ими потока выполнения основного процесса.</p>

<h2> Знакомимся с Express: фреймворк</h2>
<p><b>Express</b> — это буква E в MEAN. Поскольку Node.js — платформа, она не ограничивает то, как ее следует настраивать и использовать. Это одна из ее сильных сторон.
Но при создании сайтов и веб-приложений каждый раз приходится выполнять
несколько довольно распространенных задач. <b>Express</b> — фреймворк веб-приложений
для Node.js, спроектированный для выполнения этих задач проверенным и повторяющимся способом.</p>
<p>Как уже отмечалось, Node.js — это платформа, а не сервер. Это дает вам возможность проявить при настройке сервера свои творческие способности и заставить
его выполнять то, что другие веб-серверы делать не способны. Но это же делает
более трудным создание и запуск простого сайта.</p>
<p>Express делает эти сложности несущественными благодаря настройке веб-сервера для прослушивания входящих запросов и возврата соответствующих ответов. Дополнительно он задает структуру каталогов. Один из этих каталогов настроен для обработки статистических файлов неблокирующим образом: последнее,
что бы вы хотели для своего приложения, — необходимость ждать, пока кто-то еще
запрашивает файл CSS! Вы можете сконфигурировать эту возможность самостоятельно в Node.js, но Express делает это за вас.</p>
<h3>Маршрутизация URL для ответов</h3>
<p>Замечательная особенность Express — по-настоящему простой интерфейс для
маршрутизации входящего URL к соответствующему фрагменту кода. Неважно,
будет ли этот код выдавать статическую веб-страницу, выполнять чтение из БД
или записывать в нее, — интерфейс прост и единообразен.</p>
<p>Здесь Express фактически уменьшил сложность выполнения всего этого в Node.js,
ускоряя тем самым написание кода и облегчая его поддержку.</p>

<h3>Представления: ответы HTML</h3>
<p>Вполне возможно, что вам понадобится отвечать на много запросов к вашему приложению путем отправки браузеру HTML-кода. Думаю, вас уже не удивит, что Express
упрощает эту задачу по сравнению с нативным Node.js.</p>
<p>Express обеспечивает поддержку множества различных шаблонизаторов, упрощающих создание страниц HTML с помощью повторно используемых компонентов, а также данных из вашего приложения. Express собирает их вместе и выдает
браузеру в виде HTML-кода.</p>
<h3>Запоминаем посетителей с помощью поддержки сеансов</h3>
<p>Будучи однопоточным, Node.js не запоминает посетителей между запросами. У него
нет отдельной области оперативной памяти, выделенной только для вас, он просто
видит ряд запросов HTTP. HTTP — протокол без сохранения состояния, так что
в нем отсутствует понятие состояния сеанса. В данных условиях в Node.js сложно
создать персонализированную информацию или иметь защищенную область, в которой пользователь мог бы входить на сайт, — в этом нет особого смысла, если сайт
забывает, кто вы такой, на каждой следующей странице. Задать эту возможность,
конечно, можно, но вам придется запрограммировать ее самостоятельно.</p>
<p>Вы ни за что не поверите: у Express имеется решение и этой задачи! Express позволяет использовать сеансы, так что вы можете идентифицировать отдельных
посетителей на протяжении нескольких запросов и страниц.</p>

<h2>Знакомимся с MongoDB: база данных</h2>
<p>Способность хранить и использовать данные жизненно важна для большинства
приложений. Выбранной для стека MEAN базой данных является <b>MongoDB</b> —
буква M в MEAN. MongoDB исключительно хорошо подходит для данного стека.
Подобно Node.js, она славится своей быстротой работы и масштабируемостью.</p>
<h3>Реляционные
    и документоориентированные базы данных</h3>
<p>Ниже приведен пример реляционной таблицы:</p>
<table>
    <tr>
        <td>firstName</td>
        <td>middleName</td>
        <td>lastName</td>
        <td>maidenName</td>
        <td>Nickname</td>
    </tr>
    <tr>
        <td>Саймон</td>
        <td>Дэвид</td>
        <td>Холмс</td>
        <td></td>
        <td>Сай</td>
    </tr>
    <tr>
        <td>Салли</td>
        <td>Джун</td>
        <td>Панайоту</td>
        <td></td>
        <td></td>
    </tr>
    <tr>
        <td>Ребекка</td>
        <td></td>
        <td>Норман</td>
        <td>Холмс</td>
        <td>Бек</td>
    </tr>
</table>

<p>MongoDB не такая! MongoDB — документоориентированная БД. Строки в ней
    по-прежнему присутствуют, но столбцов как таковых нет. Вместо столбцов, описывающих, что должно быть в строке, каждая строка представляет собой документ,
    который содержит как данные, так и их описание. Пример описания коллекции
    документов см. ниже:</p>

<table>
    <tr>
        <td>firstName: &quot;Саймон&quot;</td>
        <td>middleName: &quot;Дэвид&quot;</td>
        <td>lastName: &quot;Холмс&quot;</td>
        <td>nickname: &quot;Сай&quot; </td>
    </tr>
    <tr>
        <td>lastName: &quot;Панайоту&quot; </td>
        <td>middleName: &quot;Джун&quot; </td>
        <td>firstName: &quot;Салли&quot;</td>
        <td></td>
    </tr>
    <tr>
        <td>maidenName: &quot;Холмс&quot;</td>
        <td>firstName: &quot;Ребекка&quot;</td>
        <td>lastName: &quot;Норман&quot;</td>
        <td>nickname: &quot;Бек&quot;</td>
    </tr>
</table>

<p>Такой менее структурированный подход означает, что коллекции документов
    могут содержать самые разнообразные данные. Давайте взглянем на пример документа, чтобы вы лучше поняли, что я имею в виду.</p>

<h3>Документы MongoDB: хранилище
    данных JavaScript</h3>
<p>MongoDB хранит документы в виде BSON — двоичной JSON (JavaScript Serialized
Object Notation — сериализованная нотация объектов JavaScript). Если коротко, JSON — применяемый в JavaScript способ хранения данных, поэтому MongoDB
так хорошо вписывается в ориентированный на JavaScript стек MEAN!</p>
<p>Следующий фрагмент кода демонстрирует простейший пример документа
MongoDB:</p>
<pre><code >{
"firstName" : "Саймон",
"lastName" : "Холмс",
_id : ObjectId("52279effc62ca8b0c1000007")
}</code></pre>
<p>Так что
вместо хранения набора данных, соответствующего множеству столбцов, документ
хранит пары «название/значение». Поэтому документ полезен сам по себе, так как
он и описывает и определяет данные.</p>
<p>Небольшое замечание насчет _id. Вы наверняка заметили запись _id среди названий в предыдущем примере документа MongoDB. Запись _id — уникальный
идентификатор, который MongoDB присваивает каждому новому документу при
создании.</p>

<p>MongoDB отличается от многих других документоориентированных БД поддержкой вторичной индексации и способностью работать с запросами, обладающими
широкими возможностями. Это значит, что вы можете создавать индексы не только по полю уникального идентификатора, а также что запросы к проиндексированным полям выполняются намного быстрее. Вы можете также создавать весьма
сложные запросы к базе данных MongoDB — не на уровне огромных команд SQL
с соединениями повсюду, но с возможностями, которых достаточно для выполнения большинства пользовательских сценариев.</p>

<h3>Для чего MongoDB не подходит</h3>
<p>MongoDB — не транзакционная БД и не должна использоваться в качестве таковой.
Транзакционная база данных может выполнять несколько отдельных операций как
одну транзакцию. Если какая-либо из операций в транзакции завершается неудачей,
то вся транзакция тоже завершается неудачей и ни одна из операций не выполняется. MongoDB работает не так. MongoDB рассматривает каждую операцию отдельно, и если какая-либо одна завершается неудачей, то завершается неудачей
только она, а остальные операции будут выполняться.</p>

<p>Это имеет большое значение при обновлении нескольких коллекций документов одновременно. Например, если вы создаете корзину для виртуальных покупок,
вам нужно быть уверенными, что платеж выполнен и зафиксирован, а также что
заказ отмечен как подтвержденный и предназначенный для обработки. Вам вряд
ли хочется учитывать вероятность того, что покупатель мог оплатить заказ, который
ваша система считает все еще находящимся в корзине. Так что эти две операции
должны быть связаны в одну транзакцию. Структура вашей БД может предоставлять возможность их выполнения в одной коллекции, или можно запрограммировать в логике приложения механизм отката и «страховочные сетки» на случай сбоя,
или же можно использовать транзакционную БД.</p>

<h3>Использование Mongoose
    для моделирования данных и не только</h3>
<p>Гибкость MongoDB относительно хранимых в документах данных — отличное
качество для БД. Но большинство приложений требуют для своих данных определенной структуры. Обратите внимание на то, что структуры требуют приложения, а не база данных. Так где же будет разумнее всего определить структуру
данных вашего приложения? В самом приложении!</p>
<p>той целью компания, разработавшая MongoDB, создала Mongoose. По их
собственным словам, Mongoose обеспечивает «изящное моделирование объектов
MongoDB для Node.js»</p>

<h4>Что такое моделирование данных</h4>
<p>Моделирование данных в контексте Mongoose и MongoDB — это определение того,
какие данные могут, а какие — должны присутствовать в документе. При хранении
информации пользователя вам может понадобиться возможность сохранить имя,
фамилию, адрес электронной почты и номер телефона. Но необходимы вам только
имя и адрес электронной почты, причем адрес электронной почты должен быть
неповторяющимся. Эта информация задается в схеме, которая используется как
основа для модели данных.</p>
<p>Помимо моделирования данных, Mongoose добавляет к возможностям MongoDB
множество возможностей, полезных при создании веб-приложений. Mongoose облегчает управление подключениями к базе данных MongoDB, а также сохранение
и чтение данных. Позднее мы будем все это использовать. А также обсудим, как
благодаря Mongoose вы обретаете возможность добавления проверки данных на
уровне схемы, гарантируя, что в БД можно будет сохранять только корректные
данные.</p>
<p>MongoDB — замечательный вариант БД для большинства веб-приложений,
поскольку она обеспечивает равновесие между скоростью чисто документоориентированных БД и возможностями реляционных БД. То, что данные фактически
хранятся в JSON, делает ее идеальным хранилищем данных для стека MEAN.</p>

<h2>Знакомимся с AngularJS: фреймворк
    клиентской части</h2>
<p>AngularJS — это буква A в MEAN. Говоря упрощенно, AngularJS — это фреймворк
JavaScript для работы с данными непосредственно в клиентской части.</p>
<p>Можно использовать Node.js, Express и MongoDB для создания полнофункционального, ориентированного на работу с данными веб-приложения. И на протяжении всей книги мы именно этим и будем заниматься. Но можно еще и положить
вишенку на торт, добавив к стеку AngularJS.</p>
<p>Традиционно выполняют всю обработку данных и логику приложения на сервере, который затем передает HTML-код браузеру. AngularJS дает возможность
перенести часть этой обработки и логики на браузер, оставляя серверу лишь передачу данных из БД. Мы рассмотрим это при обсуждении двусторонней привязки
данных, но сначала нужно разобраться, похож ли AngularJS на jQuery, наиболее
популярную JavaScript-библиотеку клиентской части.</p>

<h3>jQuery и AngularJS</h3>
<p>Если вы знакомы с jQuery, то, возможно, задумывались, работает ли AngularJS
схожим образом. Если коротко, то нет, не совсем. jQuery, как правило, добавляется
на страницу для обеспечения интерактивности уже после того, как HTML-код отправлен на браузер, а объектная модель документов (Document Object Model
(DOM)) полностью загружена. AngularJS подключается на шаг раньше и помогает
создавать HTML-код на основе имеющихся данных.</p>
<p>Кроме того, jQuery — библиотека, и в ней имеется набор возможностей, которые
вы можете использовать. AngularJS — то, что называется «упрямый» (opinionated)
фреймворк. Имеется в виду, что он навязывает вам свое мнение о том, как его следует использовать.</p>
<p>Как уже упоминалось, AngularJS помогает создавать HTML-код на основе
имеющихся данных, но делает не только это. Он также немедленно обновляет
HTML-код при изменении данных, причем может и обновлять данные при изменении HTML-кода. Это называется двусторонней привязкой данных, краткий обзор
которой сейчас и будет создан.</p>

<h3>Двусторонняя привязка данных: работа с данными на странице</h3>
<p>Чтобы лучше понять смысл двусторонней привязки данных, взглянем сначала на
традиционный подход — одностороннюю привязку данных. О<b>дносторонняя привязка данных</b> — это то, на что вы нацелены при изучении использования Node.js,
Express и MongoDB. Node.js получает данные от MongoDB, затем Express использует шаблон для компиляции этих данных в HTML-код, который затем отправляется серверу (рис. ниже).</p>
<img src="https://ltdfoto.ru/images/2024/07/07/image9d083c9784ef210a.png" alt="image9d083c9784ef210a.png" border="0" />
<p>Подобная однонаправленная модель — фундамент большинства ориентированных на работу с БД сайтов. В этой модели большая часть тяжелой работы выполняется на сервере, а браузеру остаются лишь формирование HTML и выполнение
интерактивного JavaScript.</p>
<p>Двусторонняя привязка данных — нечто иное. Здесь шаблон и данные отправляются браузеру независимо друг от друга. Браузер сам компилирует шаблон
в представление и данные — в модель. Главное отличие в том, что представление —
динамическое. Представление привязано к модели, так что при изменениях модели представление тоже немедленно меняется. Двусторонняя привязка данных
показана на рис. ниже.</p>
<img src="https://ltdfoto.ru/images/2024/07/07/image86494d35e1c6e6ec.png" alt="image86494d35e1c6e6ec.png" border="0" />

<h3>Использование AngularJS для загрузки новых страниц</h3>
<p>AngularJS был специально спроектирован с расчетом на функциональность, называемую одностраничными приложениями (<b>single-page application</b> (<b>SPA</b>)). Фактически SPA — это приложение, выполняющее все внутри браузера и никогда
не производящее полной перезагрузки страницы. Это значит, что вся логика приложения, обработка данных, пользовательский поток выполнения и отправка
шаблонов могут быть организованы в браузере.</p>
<p>Рассмотрим Gmail. Это пример SPA. На странице, помимо разнообразных наборов данных, показываются различные представления, но сама страница никогда
не перезагружается.</p>
<p>Такой подход способен существенно снизить количество необходимых вам
ресурсов сервера, причем фактически производится краудсорсинг требуемых
приложению вычислительных мощностей. Браузер каждого пользователя выполняет тяжелую работу, а ваш сервер, по сути, просто выдает статические файлы
и данные по запросу.</p>
<p>Подобный подход также улучшает механизм взаимодействия с пользователем.
Как только приложение загружено, количество обращений к серверу уменьшается,
что снижает вероятность задержек.</p>

<h3>Какова оборотная сторона AngulatJS?</h3>
<p>Несмотря на множество достоинств, AngularJS не годится для всех сайтов без исключения. Библиотеки клиентской части, такие как jQuery, лучше подходят для
постепенного расширения. Идея в том, что ваш сайт будет отлично работать без
JavaScript, а подключение JavaScript лишь улучшает взаимодействие с пользователем. С AngularJS и, конечно, любым другим фреймворком SPA дела обстоят
иначе. AngularJS использует JavaScript для формирования визуализируемого
HTML-кода из шаблонов и данных, так что, если ваш браузер не поддерживает
JavaScript или в коде есть ошибка, сайт вообще не будет работать.</p>
<p>Такая зависимость от JavaScript при создании страницы вызывает проблемы
с поисковыми системами. Когда поисковая система сканирует сайт своим поисковым агентом, она не запускает никакого JavaScript, а при использовании AngularJS
единственное, что у вас имеется до выполнения JavaScript, — шаблон с сервера.
Если нужно, чтобы поисковые системы индексировали ваши контент и данные,
а не шаблоны, то следует подумать, подходит ли AngularJS для данного проекта.</p>
<p>Существуют способы справиться с этой проблемой — говоря кратко, нужно,
чтобы ваш сервер выводил скомпилированное содержимое наряду с AngularJS.
Но если нет необходимости это делать, то я рекомендовал бы так не поступать.</p>
<p>Самое простое, что вы можете сделать, — использовать AngularJS для одного
и не использовать для другого. Нет ничего плохого в том, чтобы в своем проекте
использовать AngularJS выборочно. Например, у вас могут иметься насыщенное
данными интерактивное приложение или раздел сайта, для создания которых
AngularJS подходит идеально. У вас также могут быть блог или какие-то связанные
с вашим приложением маркетинговые страницы. Их не обязательно создавать
с помощью AngularJS, и, вполне возможно, лучше будет выдавать их с сервера
традиционным способом. Таким образом, часть вашего сайта выдается Node.js,
Express и MongoDB, а в другой части работает AngularJS.</p>

<h2>Вспомогательные утилиты</h2>
<p>Вы можете использовать Twitter Bootstrap для создания хорошего пользовательского интерфейса, Git — для управления кодом и Heroku — для
того, чтобы обеспечить размещение приложения на реальном URL. В следующих
главах мы рассмотрим вопрос включения этих технологий в стек MEAN. Здесь же
я просто кратко опишу, чем каждая из них может оказаться вам полезна.</p>
<h3>Применение Twitter Bootstrap
    для пользовательского интерфейса</h3>
<p>В книге мы будем использовать Twitter Bootstrap для создания адаптивного интерфейса с минимальными усилиями. Для стека он неважен, и если вы создаете
какой-то особый проект или приложение из существующего HTML-кода, то, возможно, не захотите его включать. Но мы планируем создавать приложение по
принципу ускоренной разработки программ, переходя от идеи к приложению без
учета влияния внешних факторов.</p>
<p><b>Bootstrap</b> — фреймворк клиентской части, очень полезный при создании отличного пользовательского интерфейса. Среди обеспечиваемых Bootstrap возможностей — адаптивная система сеток, стили по умолчанию для многих компонентов
интерфейса и способность менять внешний вид с помощью тем.</p>
<h4>Адаптивная система сеток</h4>
<p>При использовании адаптивного макета вы создаете отдельную страницу HTML,
которая ведет себя по-разному на различных устройствах. Это происходит скорее
в результате определения разрешения экрана, чем из-за выяснения того, какое
устройство используется. Bootstrap ориентируется в своих макетах на четыре контрольные точки по ширине в пикселах, приблизительно соответствующие телефонам, планшетам, ноутбукам и внешним мониторам. Так что если вы посвятите
немного времени обдумыванию структуры вашего HTML-кода и классов CSS, то
сможете использовать один HTML-код для выдачи одного и того же контента
в различных макетах, подходящих для различных размеров экрана.</p>
<h4>Классы CSS и компоненты HTML</h4>
<p>Bootstrap поставляется с набором встроенных классов CSS, полезных при создании
удобных визуальных компонентов. В их числе заголовки страниц, контейнеры
экстренных сообщений, метки, бейджи, стилизованные списки... и этот список
можно продолжить! Они многое продумали, и это действительно помогает быстро
создавать приложения без лишних трат времени на макет HTML и стили CSS.</p>

<h4>Добавляем темы — совсем другие ощущения</h4>
<p>Bootstrap по умолчанию предоставляет варианты оформления интерфейса, которые
обеспечивают действительно неплохую точку отсчета. Его возможности используют настолько часто, что ваш сайт может в итоге оказаться похожим на чей-то еще.
К счастью, можно скачивать темы для Bootstrap, чтобы придать вашему приложению
оригинальный вид. Скачивание темы не сложнее замены файла CSS Bootstrap
новым. В этой книге для создания нашего приложения будем использовать бесплатную тему, но на множестве сайтов в Интернете можно купить превосходные
темы, которые позволят вашему сайту производить неизгладимое впечатление.</p>



<h3>Управление исходным кодом
    с помощью Git</h3>
<p>Сохранять код на своем компьютере или сетевом диске, конечно, замечательно, но
так сохраняется только последняя версия. При этом получить доступ к ней можете только вы или кто-то из вашей сети.</p>
<p><b>Git</b> — распределенная система контроля версий и управления исходным кодом.
Это значит, что несколько человек могут работать с одной базой исходных текстов
одновременно с различных компьютеров и из различных сетей. Они могут работать
совместно, сохраняя и записывая все изменения. Также возможно при необходимости откатиться к предыдущему состоянию.</p>
<p>Git обычно используют из командной строки, хотя существуют GUI для Windows
и Mac. В данной книге мы будем использовать операторы командной строки для
необходимых нам команд. Git обладает широкими возможностями, так что мы здесь
затронем его лишь очень поверхностно, но все, что мы будем делать, будет прокомментировано.</p>

<p>В книге мы собираемся работать с Git по двум причинам.</p>
<p>Во-первых, исходный код примера приложения в этой книге будет храниться
на GitHub, для различных промежуточных этапов разработки будут созданы отдельные ветви. У нас будет возможность клонировать основной репозиторий или
отдельные его ветви, чтобы использовать соответствующий код.</p>
<p>Во-вторых, мы будем применять Git в качестве метода развертывания нашего
приложения на действующий веб-сервер, чтобы его мог увидеть весь мир. Для
хостинга используем Heroku.</p>

<h2>Как компоненты стека MEAN
    работают вместе</h2>
К тому времени, как вы закончите чтение этой книги, у вас будет работающее на
стеке MEAN приложение, повсеместно использующее JavaScript. MongoDB хранит
данные в виде двоичной JSON, которые через Mongoose доступны как JSON.
Фреймворк Express располагается поверх Node.js, весь код в котором написан на
JavaScript. На клиентской стороне располагается AngularJS — опять-таки JavaScript.
х соединения и ход выполнения демонстрирует рис. ниже:</p>
<img src="https://ltdfoto.ru/images/2024/07/07/image9d3246f1bc71f02e.png" alt="image9d3246f1bc71f02e.png" border="0" />